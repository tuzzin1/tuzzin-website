import{aN as de,aO as G,au as te,r as N,C as re,ax as ce,ay as fe,av as le,G as V,aw as ve,aP as pe,R as O,i as _,w as L,f as R,Q as oe,S as k,aA as q,aQ as P,$ as ue,aR as he,aS as me,Z as ge,aT as ae,U as ye,y as xe,a3 as be,J as ke,aJ as Ce,d as D,g as F,n as K,aL as Te,F as ne,V as se,X as Ie,e as ie,a1 as Se,t as Ee}from"./DMHkxE8P.js";import we from"./C3z01KFI.js";import{_ as Ae,M as Ke,a as _e}from"./D-KF83F8.js";function Ve(s){const l=de("",1e3);return{search:l,handleTypeaheadSearch:(S,a)=>{l.value=l.value+S;{const d=G(),p=a.map(g=>{var w,b;return{...g,textValue:((w=g.value)==null?void 0:w.textValue)??((b=g.ref.textContent)==null?void 0:b.trim())??""}}),i=p.find(g=>g.ref===d),m=p.map(g=>g.textValue),E=Be(m,l.value,i==null?void 0:i.textValue),x=p.find(g=>g.textValue===E);return x&&x.ref.focus(),x==null?void 0:x.ref}},resetTypeahead:()=>{l.value=""}}}function Re(s,l){return s.map((e,c)=>s[(l+c)%s.length])}function Be(s,l,e){const S=l.length>1&&Array.from(l).every(m=>m===l[0])?l[0]:l,a=e?s.indexOf(e):-1;let d=Re(s,Math.max(a,0));S.length===1&&(d=d.filter(m=>m!==e));const i=d.find(m=>m.toLowerCase().startsWith(S.toLowerCase()));return i!==e?i:void 0}function U(s,l,e){const c=s.findIndex(p=>te(p,l)),S=s.findIndex(p=>te(p,e));if(c===-1||S===-1)return[];const[a,d]=[c,S].sort((p,i)=>p-i);return s.slice(a,d+1)}function j(s){return s.reduce((l,e)=>(l.push(e),e.children&&l.push(...j(e.children)),l),[])}function Le(s,l){const e=N(),c=(a,d)=>{if(l.multiple&&Array.isArray(s.value))if(l.selectionBehavior==="replace")s.value=[a],e.value=a;else{const p=s.value.findIndex(i=>d(i));p!==-1?s.value.splice(p,1):s.value.push(a)}else l.selectionBehavior==="replace"?s.value={...a}:!Array.isArray(s.value)&&d(s.value)?s.value=void 0:s.value={...a};return s.value};function S(a,d,p,i){var g;if(!(e!=null&&e.value)||!l.multiple||!Array.isArray(s.value))return;const E=(g=p().filter(w=>w.ref.dataset.disabled!=="").find(w=>w.ref===d))==null?void 0:g.value;if(!E)return;let x=null;switch(a){case"prev":case"next":{x=U(i,e.value,E);break}case"first":{x=U(i,e.value,i==null?void 0:i[0]);break}case"last":{x=U(i,e.value,i==null?void 0:i[i.length-1]);break}}s.value=x}return{firstValue:e,onSelectItem:c,handleMultipleReplace:S}}const[$e,Me]=ve("TreeRoot"),Ne=re({__name:"TreeRoot",props:{modelValue:{},defaultValue:{},items:{},expanded:{},defaultExpanded:{},getKey:{},getChildren:{type:Function,default:s=>s.children},selectionBehavior:{default:"toggle"},multiple:{type:Boolean},dir:{},disabled:{type:Boolean},propagateSelect:{type:Boolean},asChild:{type:Boolean},as:{default:"ul"}},emits:["update:modelValue","update:expanded"],setup(s,{emit:l}){const e=s,c=l,{items:S,multiple:a,disabled:d,propagateSelect:p,dir:i}=ce(e),{handleTypeaheadSearch:m}=Ve(),E=fe(i),x=N(),g=N(!1),w=pe(),b=le(e,"modelValue",c,{defaultValue:e.defaultValue??(a.value?[]:void 0),passive:e.modelValue===void 0,deep:!0}),r=le(e,"expanded",c,{defaultValue:e.defaultExpanded??[],passive:e.expanded===void 0,deep:!0}),{onSelectItem:f,handleMultipleReplace:t}=Le(b,e),o=V(()=>a.value&&Array.isArray(b.value)?b.value.map(n=>e.getKey(n)):[e.getKey(b.value??{})]);function u(n,h=1,T){return n.reduce((I,A,B)=>{const $=e.getKey(A),M=e.getChildren(A),W=r.value.includes($),z={_id:$,value:A,index:B,level:h,parentItem:T,hasChildren:!!M,bind:{value:A,level:h,"aria-setsize":n.length,"aria-posinset":B+1}};return I.push(z),M&&W&&I.push(...u(M,h+1,A)),I},[])}const v=V(()=>{const n=e.items;return r.value.map(h=>h),u(n??[])});function y(n){var h;if(g.value)w.trigger(n);else{const T=((h=x.value)==null?void 0:h.getItems())??[];m(n.key,T)}}function C(n){if(g.value)return;const h=Ke[n.key];he(()=>{var T;t(h,G(),(T=x.value)==null?void 0:T.getItems,v.value.map(I=>I.value))})}return Me({modelValue:b,selectedKeys:o,onSelect:n=>{var I;const h=A=>e.getKey(A??{})===e.getKey(n),T=e.multiple&&Array.isArray(b.value)?((I=b.value)==null?void 0:I.findIndex(h))!==-1:void 0;if(f(n,h),e.propagateSelect&&e.multiple&&Array.isArray(b.value)){const A=j(e.getChildren(n)??[]);T?b.value=[...b.value].filter(B=>!A.some($=>e.getKey(B??{})===e.getKey($))):b.value=[...b.value,...A]}},expanded:r,onToggle(n){if(!(n?e.getChildren(n):void 0))return;const T=e.getKey(n)??n;r.value.includes(T)?r.value=r.value.filter(I=>I!==T):r.value.push(T)},getKey:e.getKey,getChildren:e.getChildren,items:S,expandedItems:v,disabled:d,multiple:a,dir:E,propagateSelect:p,isVirtual:g,virtualKeydownHook:w,handleMultipleReplace:t}),(n,h)=>(_(),O(k(Ae),{ref_key:"rovingFocusGroupRef",ref:x,"as-child":"",orientation:"vertical",dir:k(E)},{default:L(()=>[R(k(ue),{role:"tree",as:n.as,"as-child":n.asChild,"aria-multiselectable":k(a)?!0:void 0,onKeydown:[y,q(P(C,["shift"]),["up","down"])]},{default:L(()=>[oe(n.$slots,"default",{flattenItems:v.value,modelValue:k(b),expanded:k(r)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}}),De="tree.select",Pe="tree.toggle",Oe=re({inheritAttrs:!1,__name:"TreeItem",props:{value:{},level:{},asChild:{type:Boolean},as:{default:"li"}},emits:["select","toggle"],setup(s,{expose:l,emit:e}){const c=s,S=e,a=$e(),{getItems:d}=me(),p=V(()=>!!a.getChildren(c.value)),i=V(()=>{const t=a.getKey(c.value);return a.expanded.value.includes(t)}),m=V(()=>{const t=a.getKey(c.value);return a.selectedKeys.value.includes(t)}),E=V(()=>{if(a.propagateSelect.value&&m.value&&p.value&&Array.isArray(a.modelValue.value))return!j(a.getChildren(c.value)||[]).every(o=>a.modelValue.value.find(u=>a.getKey(u)===a.getKey(o)))});function x(t){if(p.value)if(i.value){const o=d().map(n=>n.ref),u=G(),v=o.indexOf(u),C=[...o].slice(v).find(n=>Number(n.getAttribute("data-indent"))===c.level+1);C&&C.focus()}else f(t)}function g(t){if(i.value)f(t);else{const o=d().map(n=>n.ref),u=G(),v=o.indexOf(u),C=[...o].slice(0,v).reverse().find(n=>Number(n.getAttribute("data-indent"))===c.level-1);C&&C.focus()}}async function w(t){S("select",t),!(t!=null&&t.defaultPrevented)&&a.onSelect(c.value)}async function b(t){S("toggle",t),!(t!=null&&t.defaultPrevented)&&a.onToggle(c.value)}async function r(t){if(!t)return;const o={originalEvent:t,value:c.value,isExpanded:i.value,isSelected:m.value};ae(De,w,o)}async function f(t){if(!t)return;const o={originalEvent:t,value:c.value,isExpanded:i.value,isSelected:m.value};ae(Pe,b,o)}return l({isExpanded:i,isSelected:m,isIndeterminate:E,handleToggle:()=>a.onToggle(c.value),handleSelect:()=>a.onSelect(c.value)}),(t,o)=>(_(),O(k(_e),{"as-child":"",value:t.value,"allow-shift-key":""},{default:L(()=>[R(k(ue),ge(t.$attrs,{role:"treeitem",as:t.as,"as-child":t.asChild,"aria-selected":m.value,"aria-expanded":p.value?i.value:void 0,"aria-level":t.level,"data-indent":t.level,"data-selected":m.value?"":void 0,"data-expanded":i.value?"":void 0,onKeydown:[q(P(r,["self","prevent"]),["enter","space"]),o[0]||(o[0]=q(P(u=>k(a).dir.value==="ltr"?x(u):g(u),["prevent"]),["right"])),o[1]||(o[1]=q(P(u=>k(a).dir.value==="ltr"?g(u):x(u),["prevent"]),["left"]))],onClick:o[2]||(o[2]=P(u=>{r(u),f(u)},["stop"]))}),{default:L(()=>[oe(t.$slots,"default",{isExpanded:i.value,isSelected:m.value,isIndeterminate:E.value,handleSelect:()=>k(a).onSelect(t.value),handleToggle:()=>k(a).onToggle(t.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}}),We={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},Ge={__name:"ProseCodeTree",props:{defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(s){const l=s,e=ye(),c=xe(),[S,a]=be(),d=V(()=>{var r,f;return se({extend:se(We),...((f=(r=c.uiPro)==null?void 0:r.prose)==null?void 0:f.codeTree)||{}})()}),p=N(l.defaultValue?{path:l.defaultValue}:void 0),i=N(),m=N(1),E=V(()=>{var r,f;return m.value,((f=(r=e.default)==null?void 0:r.call(e))==null?void 0:f.flatMap(w).filter(Boolean))||[]}),x=V(()=>g(E.value));function g(r){const f=new Map,t=[];r.forEach(u=>{const v=u.label.split("/");let y="";v.forEach((C,n)=>{var h,T;if(y=y?`${y}/${C}`:C,!f.has(y)){const I={label:C,path:y,...n<v.length-1&&{children:[]}};f.set(y,I),n===0?t.push(I):(T=(h=f.get(v.slice(0,n).join("/")))==null?void 0:h.children)==null||T.push(I)}})});const o=u=>u.sort((v,y)=>!!v.children==!!y.children?v.label.localeCompare(y.label):y.children?1:-1).map(v=>({...v,children:v.children&&o(v.children)}));return o(t)}function w(r,f){var t,o,u,v;return typeof r.type=="symbol"?(t=r.children)==null?void 0:t.map(w):{label:((o=r.props)==null?void 0:o.filename)||((u=r.props)==null?void 0:u.label)||`${f}`,icon:(v=r.props)==null?void 0:v.icon,component:r}}const b=V(()=>{var t;if(l.expandAll){const o=new Set;return E.value.forEach(u=>{const v=u.label.split("/");for(let y=1;y<v.length;y++)o.add(v.slice(0,y).join("/"))}),Array.from(o)}const r=(t=p.value)==null?void 0:t.path;if(!r)return[];const f=r.split("/");return f.map((o,u)=>f.slice(0,u+1).join("/"))});return ke(p,r=>{const f=E.value.find(t=>(r==null?void 0:r.path)===t.label);f!=null&&f.component&&(i.value=f)},{immediate:!0}),Ce(()=>m.value++),(r,f)=>{var o,u,v,y;const t=Se;return _(),D(ne,null,[R(k(S),null,{default:L(({items:C,level:n})=>[(_(!0),D(ne,null,Ie(C,(h,T)=>{var I,A;return _(),D("li",{key:`${n}-${T}`,class:K(n>0?d.value.itemWithChildren({class:(I=l.ui)==null?void 0:I.itemWithChildren}):d.value.item({class:(A=l.ui)==null?void 0:A.item}))},[R(k(Oe),{"as-child":"",level:n,value:h},{default:L(({isExpanded:B,isSelected:$})=>{var M,W,z,H,J,Q,X,Y,Z,ee;return[F("button",{class:K(d.value.link({class:(M=l.ui)==null?void 0:M.link,active:$}))},[(W=h.children)!=null&&W.length?(_(),O(t,{key:0,name:B?k(c).ui.icons.folderOpen:k(c).ui.icons.folder,class:K(d.value.linkLeadingIcon({class:(z=l.ui)==null?void 0:z.linkLeadingIcon}))},null,8,["name","class"])):(_(),O(we,{key:1,filename:h.label,class:K(d.value.linkLeadingIcon({class:(H=l.ui)==null?void 0:H.linkLeadingIcon}))},null,8,["filename","class"])),F("span",{class:K(d.value.linkLabel({class:(J=l.ui)==null?void 0:J.linkLabel}))},Ee(h.label),3),(Q=h.children)!=null&&Q.length?(_(),D("span",{key:2,class:K(d.value.linkTrailing({class:(X=l.ui)==null?void 0:X.linkTrailing}))},[R(t,{name:k(c).ui.icons.chevronDown,class:K(d.value.linkTrailingIcon({class:(Y=l.ui)==null?void 0:Y.linkTrailingIcon}))},null,8,["name","class"])],2)):ie("",!0)],2),(Z=h.children)!=null&&Z.length&&B?(_(),D("ul",{key:0,class:K(d.value.listWithChildren({class:(ee=l.ui)==null?void 0:ee.listWithChildren}))},[R(k(a),{items:h.children,level:n+1},null,8,["items","level"])],2)):ie("",!0)]}),_:2},1032,["level","value"])],2)}),128))]),_:1}),F("div",{class:K(d.value.root({class:[l.class,(o=l.ui)==null?void 0:o.root]}))},[R(k(Ne),{modelValue:p.value,"onUpdate:modelValue":f[0]||(f[0]=C=>p.value=C),class:K(d.value.list({class:(u=l.ui)==null?void 0:u.list})),items:x.value,"get-key":C=>C.path,"default-expanded":b.value},{default:L(()=>[R(k(a),{items:x.value,level:0},null,8,["items"])]),_:1},8,["modelValue","class","items","get-key","default-expanded"]),F("div",{class:K(d.value.content({class:(v=l.ui)==null?void 0:v.content}))},[(_(),O(Te((y=i.value)==null?void 0:y.component)))],2)],2)],64)}}};export{Ge as default};
